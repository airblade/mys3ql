#!/usr/bin/env ruby-local-exec

lib_dir = File.join(File.dirname(__FILE__), '..', 'lib')
$LOAD_PATH.unshift lib_dir if File.directory?(lib_dir)

require 'mys3ql'
require 'optparse'

params = {}
op = OptionParser.new do |opts|
  opts.banner = 'Usage: mys3ql <full|incremental|restore> <[args]>'

  opts.on '-c', '--config CONFIG', 'Load configuration from YAML file (default ~/.mys3ql)'
  opts.on_tail '-d', '--debug', 'Be verbose'
  opts.on_tail '-v', '--version', 'Print version' do
    puts "mys3ql v#{Mys3ql::VERSION}"
    exit
  end
end
op.parse!(into: params)

params[:command] = ARGV[0]
unless %w[full incremental restore].include? params[:command]
  puts op.help
  exit 1
end

Mys3ql::Conductor.run params[:command], params[:config], params[:debug]
