#!/usr/bin/env ruby-local-exec

lib_dir = File.join(File.dirname(__FILE__), '..', 'lib')
$LOAD_PATH.unshift lib_dir if File.directory?(lib_dir)

require 'mys3ql'
require 'choice'

Choice.options do

  header ''
  header 'Specific options:'

  option :full do
    short '-f'
    long '--full'
    desc 'Dump database, push to S3, and clean up bin logs on S3'
  end

  option :incremental do
    short '-i'
    long '--incremental'
    desc "Push mysql's bin logs to S3"
  end

  option :config do
    short '-c'
    long '--config=FILE'
    desc 'Load configuration from YAML file (default: ~/.mys3ql)'
    default '~/.mys3ql'
  end

  separator ''
  separator 'General options:'

  option :debug do
    short '-d'
    long '--debug'
    desc 'Turn on debugging mode'
  end

  option :help do
    long '--help'
    desc 'Show this message'
  end

  option :version do
    short '-v'
    long '--version'
    desc 'Show version'
    action do
      puts "mys3ql v#{Mys3ql::VERSION}"
      exit
    end
  end

end

Mys3ql::Conductor.run Choice.choices
